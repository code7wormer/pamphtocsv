<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pamphlet Data Extractor | UTR Wholesale - Gemini Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4285F4;
            --secondary: #EA4335;
            --accent: #FBBC04;
            --success: #34A853;
            --dark: #0A0E27;
            --darker: #050814;
            --text: #E8EAED;
            --text-dim: #9BA3AF;
            --border: rgba(66, 133, 244, 0.2);
            --glow: rgba(66, 133, 244, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--darker);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, rgba(66, 133, 244, 0.03) 1px, transparent 1px),
                linear-gradient(rgba(66, 133, 244, 0.03) 1px, transparent 1px);
            background-size: 60px 60px;
            animation: gridMove 20s linear infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(60px, 60px); }
        }

        .orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.15;
            pointer-events: none;
            z-index: 0;
        }

        .orb-1 {
            width: 500px;
            height: 500px;
            background: var(--primary);
            top: -150px;
            right: -150px;
            animation: float 15s ease-in-out infinite;
        }

        .orb-2 {
            width: 400px;
            height: 400px;
            background: var(--secondary);
            bottom: -100px;
            left: -100px;
            animation: float 18s ease-in-out infinite reverse;
        }

        .orb-3 {
            width: 300px;
            height: 300px;
            background: var(--accent);
            top: 50%;
            left: 50%;
            animation: float 12s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(50px, 50px) scale(1.1); }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            margin-bottom: 60px;
            animation: slideDown 0.8s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-size: clamp(2.5rem, 6vw, 4.5rem);
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary) 0%, var(--success) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 16px;
            letter-spacing: -0.02em;
            line-height: 1.1;
        }

        .subtitle {
            font-size: 1.25rem;
            color: var(--text-dim);
            font-weight: 300;
            margin-bottom: 12px;
        }

        .tech-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(66, 133, 244, 0.1);
            border: 1px solid var(--border);
            border-radius: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--primary);
            margin-top: 12px;
        }

        .tech-badge::before {
            content: 'üî∑';
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        .main-card {
            background: rgba(10, 14, 39, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 48px;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.5),
                0 0 100px rgba(66, 133, 244, 0.05);
            animation: slideUp 0.8s ease-out 0.2s both;
            position: relative;
            overflow: hidden;
        }

        .main-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, 
                transparent, 
                var(--primary), 
                var(--success), 
                var(--accent), 
                transparent
            );
            animation: shimmer 3s linear infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .upload-zone {
            border: 2px dashed var(--border);
            border-radius: 16px;
            padding: 60px 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            background: rgba(66, 133, 244, 0.02);
            margin-bottom: 32px;
        }

        .upload-zone:hover {
            border-color: var(--primary);
            background: rgba(66, 133, 244, 0.05);
            box-shadow: 0 0 40px var(--glow);
            transform: translateY(-2px);
        }

        .upload-zone.dragover {
            border-color: var(--primary);
            background: rgba(66, 133, 244, 0.1);
            box-shadow: 0 0 60px var(--glow);
        }

        .upload-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            display: block;
            animation: float 3s ease-in-out infinite;
        }

        .upload-text {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 8px;
        }

        .upload-hint {
            font-size: 0.95rem;
            color: var(--text-dim);
        }

        #fileInput {
            display: none;
        }

        .preview-container {
            display: grid;
            gap: 24px;
            margin-bottom: 32px;
        }

        .preview-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .preview-item img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .preview-info {
            flex: 1;
        }

        .preview-name {
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
        }

        .preview-size {
            font-size: 0.85rem;
            color: var(--text-dim);
            font-family: 'JetBrains Mono', monospace;
        }

        .btn-remove {
            background: rgba(234, 67, 53, 0.1);
            border: 1px solid rgba(234, 67, 53, 0.3);
            color: var(--secondary);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-remove:hover {
            background: rgba(234, 67, 53, 0.2);
            transform: scale(1.05);
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-group label {
            display: block;
            color: var(--text);
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.2s;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(66, 133, 244, 0.2);
        }

        .action-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--success) 100%);
            color: white;
            box-shadow: 0 8px 24px rgba(66, 133, 244, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(66, 133, 244, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .log-container {
            margin-top: 32px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            display: none;
        }

        .log-container.show {
            display: block;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .log-header {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .log-entry {
            padding: 8px 12px;
            margin-bottom: 8px;
            border-left: 3px solid transparent;
            border-radius: 4px;
            animation: logAppear 0.3s ease-out;
        }

        @keyframes logAppear {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .log-entry.info {
            border-left-color: var(--primary);
            background: rgba(66, 133, 244, 0.05);
            color: var(--primary);
        }

        .log-entry.success {
            border-left-color: var(--success);
            background: rgba(52, 168, 83, 0.05);
            color: var(--success);
        }

        .log-entry.warning {
            border-left-color: var(--accent);
            background: rgba(251, 188, 4, 0.05);
            color: var(--accent);
        }

        .log-entry.error {
            border-left-color: var(--secondary);
            background: rgba(234, 67, 53, 0.05);
            color: var(--secondary);
        }

        .log-timestamp {
            opacity: 0.6;
            font-size: 0.75rem;
            margin-right: 8px;
        }

        .prompt-box {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 24px;
            margin-top: 32px;
            display: none;
        }

        .prompt-box.show {
            display: block;
            animation: slideIn 0.4s ease-out;
        }

        .prompt-header {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .prompt-content {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(66, 133, 244, 0.2);
            border-radius: 8px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--text-dim);
            white-space: pre-wrap;
            word-break: break-word;
        }

        .copy-btn {
            margin-top: 16px;
            background: linear-gradient(135deg, var(--accent) 0%, #E8B42E 100%);
            color: var(--dark);
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(251, 188, 4, 0.3);
        }

        .instructions {
            margin-top: 48px;
            padding: 32px;
            background: rgba(251, 188, 4, 0.05);
            border: 1px solid rgba(251, 188, 4, 0.2);
            border-radius: 16px;
        }

        .instructions h2 {
            color: var(--accent);
            font-size: 1.5rem;
            margin-bottom: 16px;
        }

        .instructions ol {
            margin-left: 20px;
            color: var(--text-dim);
            line-height: 1.8;
        }

        .instructions li {
            margin-bottom: 8px;
        }

        .instructions code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            color: var(--primary);
            font-size: 0.9em;
        }

        .instructions a {
            color: var(--primary);
            text-decoration: underline;
        }

        .alert-box {
            background: rgba(251, 188, 4, 0.1);
            border: 1px solid rgba(251, 188, 4, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .alert-box h3 {
            color: var(--accent);
            font-size: 1.1rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alert-box p {
            color: var(--text-dim);
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .main-card {
                padding: 32px 24px;
            }

            h1 {
                font-size: 2.5rem;
            }

            .upload-zone {
                padding: 40px 24px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        .loader {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(66, 133, 244, 0.3);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>

    <div class="container">
        <header>
            <h1>üî∑ Pamphlet Data Extractor</h1>
            <p class="subtitle">Transform product catalogs into structured CSV files instantly</p>
            <span class="tech-badge">Powered by Google Gemini Pro</span>
        </header>

        <div class="main-card">
            <div class="alert-box">
                <h3>‚ö†Ô∏è First Time Setup Required</h3>
                <p>Before using this tool, you need to set up Gemini with web search capability. Copy the system prompt below and paste it as your FIRST message to Gemini, then you can use this tool for all future extractions.</p>
            </div>

            <div class="upload-zone" id="uploadZone">
                <span class="upload-icon">üì§</span>
                <div class="upload-text">Drop pamphlet images here</div>
                <div class="upload-hint">or click to browse ‚Ä¢ Supports JPG, PNG, WebP</div>
                <input type="file" id="fileInput" accept="image/*" multiple>
            </div>

            <div class="preview-container" id="previewContainer"></div>

            <div class="form-group">
                <label>Category ID (from your Supabase categories table):</label>
                <input type="text" id="categoryIdInput" placeholder="e.g., a1ba6b59-6017-4b0d-91f4-ff3062679f69">
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" id="generateBtn" disabled>
                    <span>üîÆ Generate Gemini Prompt</span>
                </button>
            </div>

            <div class="log-container" id="logContainer">
                <div class="log-header">
                    <span class="loader"></span>
                    <span>Processing Log</span>
                </div>
                <div id="logContent"></div>
            </div>

            <div class="prompt-box" id="systemPromptBox">
                <div class="prompt-header">
                    <span>üîß</span>
                    <span>Step 1: Copy this SYSTEM PROMPT (one-time setup)</span>
                </div>
                <div class="prompt-content" id="systemPromptContent">You are a product data extraction assistant specialized in creating CSV files for e-commerce databases. When analyzing product catalog images, you:

1. Extract product names and prices with extreme precision
2. Use Google Search to find REAL product information
3. Create SHORT descriptions (under 10 words) that are catchy and clear
4. Write detailed descriptions (1-2 sentences) with comprehensive product info from web search
5. Generate clean, SEO-friendly URL slugs
6. Format data as CSV with exact column specifications
7. CROP and optimize product images for e-commerce display

IMAGE OPTIMIZATION REQUIREMENTS:
- Identify each individual product in the catalog image
- Crop each product to its own clean image (remove background/clutter)
- Resize to 800x800px square format (perfect for product cards and detail pages)
- Provide download link for each cropped image
- Name files as: {product-slug}.jpg (e.g., "skiing-bear-toy-candy-12ct.jpg")

When given product images, you will:
- Identify all visible products
- Extract exact names and prices
- CROP each product from the catalog into individual 800x800px images
- Search for each product to get authentic information
- Write brief, punchy descriptions (under 10 words)
- Write detailed descriptions with full product information from search
- Create proper slugs (lowercase, hyphens, no special chars)
- Output structured CSV data
- Provide downloadable cropped images for each product

You maintain high accuracy and always verify information through web search before including descriptions.</div>
                <button class="copy-btn" id="copySystemBtn">
                    <span>üìã</span>
                    <span>Copy System Prompt</span>
                </button>
            </div>

            <div class="prompt-box" id="promptBox">
                <div class="prompt-header">
                    <span>üìã</span>
                    <span>Step 2: Copy this prompt and paste in Gemini with your images</span>
                </div>
                <div class="prompt-content" id="promptContent"></div>
                <button class="copy-btn" id="copyBtn">
                    <span>üìã</span>
                    <span>Copy Extraction Prompt</span>
                </button>
            </div>

            <div class="instructions">
                <h2>üöÄ How to Use (Gemini Edition)</h2>
                <ol>
                    <li><strong>First Time Setup:</strong> Copy the "System Prompt" above</li>
                    <li>Go to <a href="https://aistudio.google.com/app/prompts/new_chat" target="_blank">Google AI Studio</a> (free, no API key needed in browser)</li>
                    <li>Paste the system prompt as your FIRST message (this sets up Gemini's behavior)</li>
                    <li><strong>Then for each extraction:</strong></li>
                    <li>Upload your pamphlet images here</li>
                    <li>Enter your category_id from Supabase</li>
                    <li>Click "Generate Gemini Prompt"</li>
                    <li>Copy the extraction prompt</li>
                    <li>In the SAME Gemini chat, attach your images and paste the prompt</li>
                    <li>Gemini will search the web for descriptions and generate your CSV</li>
                    <li>Download the CSV from Gemini's response</li>
                    <li>Import to Supabase: Table Editor ‚Üí Products ‚Üí Insert ‚Üí "Import data from CSV"</li>
                </ol>
                <p style="margin-top: 16px; color: var(--text-dim);">
                    <strong>Pro Tip:</strong> Keep the same Gemini chat open and reuse it for multiple extractions - you only need to send the system prompt once!
                </p>
                <p style="margin-top: 12px; color: var(--success); font-size: 0.9rem;">
                    ‚ú® Gemini will automatically search Google for real product descriptions and generate proper slugs!
                </p>
            </div>
        </div>
    </div>

    <script>
        let uploadedFiles = [];
        let logEntries = [];

        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');
        const previewContainer = document.getElementById('previewContainer');
        const generateBtn = document.getElementById('generateBtn');
        const logContainer = document.getElementById('logContainer');
        const logContent = document.getElementById('logContent');
        const promptBox = document.getElementById('promptBox');
        const promptContent = document.getElementById('promptContent');
        const copyBtn = document.getElementById('copyBtn');
        const systemPromptBox = document.getElementById('systemPromptBox');
        const systemPromptContent = document.getElementById('systemPromptContent');
        const copySystemBtn = document.getElementById('copySystemBtn');
        const categoryIdInput = document.getElementById('categoryIdInput');

        // Show system prompt by default
        systemPromptBox.classList.add('show');

        // Logging system
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = { timestamp, message, type };
            logEntries.push(entry);

            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.innerHTML = `<span class="log-timestamp">[${timestamp}]</span>${message}`;
            logContent.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function showLog() {
            logContainer.classList.add('show');
        }

        function clearLog() {
            logContent.innerHTML = '';
            logEntries = [];
        }

        // Upload zone interactions
        uploadZone.addEventListener('click', () => fileInput.click());
        
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            addLog(`üìÅ Received ${files.length} file(s)`, 'info');
            showLog();

            Array.from(files).forEach((file, index) => {
                if (file.type.startsWith('image/')) {
                    uploadedFiles.push(file);
                    addLog(`‚úì Added: ${file.name} (${(file.size / 1024).toFixed(1)} KB)`, 'success');
                    addPreview(file);
                } else {
                    addLog(`‚úó Skipped: ${file.name} (not an image)`, 'warning');
                }
            });
            updateUI();
        }

        function addPreview(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const preview = document.createElement('div');
                preview.className = 'preview-item';
                preview.innerHTML = `
                    <img src="${e.target.result}" alt="${file.name}">
                    <div class="preview-info">
                        <div class="preview-name">${file.name}</div>
                        <div class="preview-size">${(file.size / 1024).toFixed(1)} KB</div>
                    </div>
                    <button class="btn-remove" onclick="removeFile('${file.name}')">Remove</button>
                `;
                previewContainer.appendChild(preview);
            };
            reader.readAsDataURL(file);
        }

        window.removeFile = function(fileName) {
            uploadedFiles = uploadedFiles.filter(f => f.name !== fileName);
            const previews = previewContainer.children;
            Array.from(previews).forEach(preview => {
                if (preview.querySelector('.preview-name').textContent === fileName) {
                    preview.remove();
                }
            });
            addLog(`üóëÔ∏è Removed: ${fileName}`, 'info');
            updateUI();
        };

        function updateUI() {
            generateBtn.disabled = uploadedFiles.length === 0;
        }

        generateBtn.addEventListener('click', async () => {
            const categoryId = categoryIdInput.value.trim();
            if (!categoryId) {
                alert('Please enter a category ID');
                addLog('‚ùå Missing category ID', 'error');
                return;
            }

            generateBtn.disabled = true;
            clearLog();
            showLog();
            
            addLog('üöÄ Starting prompt generation...', 'info');
            addLog(`üìä Processing ${uploadedFiles.length} image(s)`, 'info');
            addLog(`üè∑Ô∏è Using category_id: ${categoryId}`, 'info');

            try {
                addLog('üé® Building Gemini extraction prompt...', 'info');
                
                const prompt = buildGeminiPrompt(categoryId, uploadedFiles.length);
                
                addLog('‚úì Prompt generated successfully!', 'success');
                addLog(`üìè Prompt size: ${(prompt.length / 1024).toFixed(1)} KB`, 'info');
                addLog('üìã Scroll down to copy the prompt', 'success');
                addLog(`üìé Remember to attach ${uploadedFiles.length} image(s) to your Gemini message!`, 'warning');

                promptContent.textContent = prompt;
                promptBox.classList.add('show');

            } catch (error) {
                addLog(`‚ùå Error: ${error.message}`, 'error');
                console.error(error);
            } finally {
                generateBtn.disabled = false;
            }
        });

        function buildGeminiPrompt(categoryId, imageCount) {
            return `Extract product data from the ${imageCount} attached image(s) and create a CSV file for my Supabase database.

DATABASE SCHEMA - Use these EXACT columns:
name,description,detailed_description,price,image_url,category_id,slug,stock_status,is_active,is_deal,deal_price,is_bestseller

EXTRACTION REQUIREMENTS:
1. Extract ALL products visible in the image(s)
2. For EACH product, use Google Search to find real product information
3. Generate clean URL slugs (lowercase, hyphens, no special characters)
4. Extract exact prices as shown (numbers only, no $ symbols)
5. CROP each product into individual 800x800px images

FIELD SPECIFICATIONS:
- name: Exact product name from image
- description: SHORT catchy description under 10 words (e.g., "Soft gummy candy with toy figurine")
- detailed_description: Full product description from Google Search (1-2 sentences with real product info)
- price: Numeric only (e.g., 19.99, not $19.99)
- image_url: LEAVE EMPTY FOR NOW (you'll provide download links separately)
- category_id: ${categoryId}
- slug: Auto-generate from name (e.g., "Skiing Bear Candy" ‚Üí "skiing-bear-candy")
- stock_status: in_stock
- is_active: true
- is_deal: false
- deal_price: (leave empty)
- is_bestseller: false

IMAGE CROPPING INSTRUCTIONS:
‚úì Crop each product from the catalog into its own clean image
‚úì Remove background clutter, focus on the product only
‚úì Resize to 800x800px square format
‚úì Name each file as: {product-slug}.jpg
‚úì After generating the CSV, provide download links for all cropped images
‚úì Example: "skiing-bear-toy-candy-12ct.jpg"

CRITICAL INSTRUCTIONS:
‚úì Search Google for each product to get REAL information
‚úì description: Keep it SHORT and catchy (under 10 words)
‚úì detailed_description: Full sentences with comprehensive info from web search (1-2 sentences)
‚úì Be precise with product names and prices from the images
‚úì Generate proper slugs (lowercase, replace spaces/special chars with hyphens)
‚úì Output ONLY the CSV data (no markdown, no explanations)
‚úì First row must be the header row
‚úì Use commas as delimiters, quotes around fields containing commas

OUTPUT FORMAT:
1. First, provide the CSV with the header row, then one row per product (make it downloadable)
2. After the CSV, crop each product from the catalog image into individual 800x800px images
3. Provide download links for each cropped image named as {product-slug}.jpg

Ready? Analyze the attached ${imageCount} image(s), create the CSV, and crop the product images.`;
        }

        copySystemBtn.addEventListener('click', () => {
            const text = systemPromptContent.textContent;
            navigator.clipboard.writeText(text).then(() => {
                const originalText = copySystemBtn.innerHTML;
                copySystemBtn.innerHTML = '<span>‚úì</span><span>Copied!</span>';
                addLog('üìã System prompt copied!', 'success');
                addLog('üëâ Paste this in Gemini as your first message', 'info');
                setTimeout(() => {
                    copySystemBtn.innerHTML = originalText;
                }, 2000);
            });
        });

        copyBtn.addEventListener('click', () => {
            const text = promptContent.textContent;
            navigator.clipboard.writeText(text).then(() => {
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = '<span>‚úì</span><span>Copied!</span>';
                addLog('üìã Extraction prompt copied!', 'success');
                addLog(`üëâ Attach your ${uploadedFiles.length} image(s) and paste in Gemini`, 'info');
                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                }, 2000);
            });
        });
    </script>
</body>
</html>
